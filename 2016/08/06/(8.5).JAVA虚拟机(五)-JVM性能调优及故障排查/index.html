<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="JVM,hotspot," />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="JVM常见问题及性能分析你遇到过这些问题吗？ OOM: Heap, Stack, Perm 系统频繁GC Java进程占用CPU过高 Java占用内存增长很快 远程调用timeout 系统响应时间变长，越来越慢 …… 方法一：GC log 1.开启GC日志：-XX:+PrintGCDetails (包含-XX:+PrintGC -verbose:gc ) 2.GC触发时间：-XX:+PrintGC">
<meta name="keywords" content="JVM,hotspot">
<meta property="og:type" content="article">
<meta property="og:title" content="java虚拟机-故障排查">
<meta property="og:url" content="/2016/08/06/(8.5).JAVA虚拟机(五)-JVM性能调优及故障排查/index.html">
<meta property="og:site_name" content="Meteor">
<meta property="og:description" content="JVM常见问题及性能分析你遇到过这些问题吗？ OOM: Heap, Stack, Perm 系统频繁GC Java进程占用CPU过高 Java占用内存增长很快 远程调用timeout 系统响应时间变长，越来越慢 …… 方法一：GC log 1.开启GC日志：-XX:+PrintGCDetails (包含-XX:+PrintGC -verbose:gc ) 2.GC触发时间：-XX:+PrintGC">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2016-09-06T03:21:24.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="java虚拟机-故障排查">
<meta name="twitter:description" content="JVM常见问题及性能分析你遇到过这些问题吗？ OOM: Heap, Stack, Perm 系统频繁GC Java进程占用CPU过高 Java占用内存增长很快 远程调用timeout 系统响应时间变长，越来越慢 …… 方法一：GC log 1.开启GC日志：-XX:+PrintGCDetails (包含-XX:+PrintGC -verbose:gc ) 2.GC触发时间：-XX:+PrintGC">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> java虚拟机-故障排查 | Meteor </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Meteor</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                java虚拟机-故障排查
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2016-08-06T16:37:35+08:00" content="2016-08-06">
              2016-08-06
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/JVM/" itemprop="url" rel="index">
                    <span itemprop="name">JVM</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h2 id="JVM常见问题及性能分析"><a href="#JVM常见问题及性能分析" class="headerlink" title="JVM常见问题及性能分析"></a>JVM常见问题及性能分析</h2><p>你遇到过这些问题吗？</p>
<pre><code>OOM: Heap, Stack, Perm
系统频繁GC
Java进程占用CPU过高
Java占用内存增长很快
远程调用timeout
系统响应时间变长，越来越慢
……
</code></pre><h3 id="方法一：GC-log"><a href="#方法一：GC-log" class="headerlink" title="方法一：GC log"></a>方法一：GC log</h3><ul>
<li>1.开启GC日志：-XX:+PrintGCDetails (包含-XX:+PrintGC -verbose:gc )</li>
<li>2.GC触发时间：-XX:+PrintGCDateStamps/-XX:+PrintGCTimeStamps </li>
<li><p>3.日志存放位置：-Xloggc:/path/gc.log</p>
<pre><code>配置JVM参数：
-XX:+UseConcMarkSweepGC -XX:+PrintGCDetails -XX:+PrintGCDateStamps 
-Xloggc:D:/logs/gc/gc.log 
</code></pre></li>
</ul>
<p>输出日志：</p>
<p>2016-03-08T16:11:05.446+0800: 8.861: [GC2016-03-08T16:11:05.446+0800: 8.861: [ParNew: 46080K-&gt;5120K(46080K), 0.0177669 secs] 66765K-&gt;28892K(97280K), 0.0178659 secs] [Times: user=0.03 sys=0.00, real=0.02 secs]<br>2016-03-08T17:01:01.930+0800: 375.874: [Full GC2016-03-08T17:01:01.930+0800: 375.874: [CMS: 40535K-&gt;40535K(51200K), 0.1600130 secs] 79475K-&gt;59991K(97280K), [CMS Perm : 36535K-&gt;36535K(51200K)], 0.1601362 secs] [Times: user=0.16 sys=0.00, real=0.16 secs] </p>
<p>可参考：</p>
<p>官网：<a href="https://blogs.oracle.com/poonam/entry/understanding_cms_gc_logs" target="_blank" rel="external">https://blogs.oracle.com/poonam/entry/understanding_cms_gc_logs</a></p>
<p>并发编程网：<a href="http://ifeve.com/jvm-cms-log/" target="_blank" rel="external">http://ifeve.com/jvm-cms-log/</a></p>
<h3 id="方法二：jdk自带命令"><a href="#方法二：jdk自带命令" class="headerlink" title="方法二：jdk自带命令"></a>方法二：jdk自带命令</h3><pre><code>jps  ： jps可以理解为java的ps，用于显示java进程 ,-v 输出虚拟机启动的时的参数   
        jps –v pid       
jinfo：jinfo查看和调整虚拟机的各项参数   
        jinfo  pid
jmap ：jmap生成堆转存快照文件
        jmap –heap pid显示Java堆详细信息，如使用哪种回收器，参数配置、分代状况
jstat：jstat 统计信息监视工具
       jstat –gcutil pid  主要关注已使用空间占总空间的百分比
jstack：jstack生成当前时刻线程快照
        jstack pid 
         检测cpu使用率飙高时三个步骤： 
           1.查该进程最高的线程  top –Hp pid
           2.转换最高线程id 为16进程
           3.查看堆栈对应线程id的堆栈信息
</code></pre><blockquote>
<p>性能调试：</p>
</blockquote>
<pre><code>cd `dirname $0`
PID=$1
BIN_DIR=`pwd`
cd $BIN_DIR
DUMP_DIR=./
DUMP_DATE=`date +%Y%m%d%H%M%S`
DATE_DIR=$DUMP_DIR/$DUMP_DATE
if [ ! -d $DATE_DIR ]; then
        mkdir $DATE_DIR
fi

echo -e &quot;Dumping the jdump ...\c&quot;
jstack $PID &gt; $DATE_DIR/jstack-$PID.dump 2&gt;&amp;1
echo -e &quot;.\c&quot;
jinfo $PID &gt; $DATE_DIR/jinfo-$PID.dump 2&gt;&amp;1
echo -e &quot;.\c&quot;
jstat -gcutil $PID &gt; $DATE_DIR/jstat-gcutil-$PID.dump 2&gt;&amp;1
echo -e &quot;.\c&quot;
jstat -gccapacity $PID &gt; $DATE_DIR/jstat-gccapacity-$PID.dump 2&gt;&amp;1
echo -e &quot;.\c&quot;
jmap $PID &gt; $DATE_DIR/jmap-$PID.dump 2&gt;&amp;1
echo -e &quot;.\c&quot;
jmap -heap $PID &gt; $DATE_DIR/jmap-heap-$PID.dump 2&gt;&amp;1
echo -e &quot;.\c&quot;
jmap -histo $PID &gt; $DATE_DIR/jmap-histo-$PID.dump 2&gt;&amp;1
echo -e &quot;.\c&quot;
if [ -r /usr/sbin/lsof ]; then
/usr/sbin/lsof -p $PID &gt; $DATE_DIR/lsof-$PID.dump
echo -e &quot;.\c&quot;
fi

if [ -r /bin/netstat ]; then
/bin/netstat -an &gt; $DATE_DIR/netstat.dump 2&gt;&amp;1
echo -e &quot;.\c&quot;
fi
if [ -r /usr/bin/iostat ]; then
/usr/bin/iostat &gt; $DATE_DIR/iostat.dump 2&gt;&amp;1
echo -e &quot;.\c&quot;
fi
if [ -r /usr/bin/mpstat ]; then
/usr/bin/mpstat -P ALL &gt; $DATE_DIR/mpstat.dump 2&gt;&amp;1
echo -e &quot;.\c&quot;
fi
if [ -r /usr/bin/vmstat ]; then
/usr/bin/vmstat &gt; $DATE_DIR/vmstat.dump 2&gt;&amp;1
echo -e &quot;.\c&quot;
fi
if [ -r /usr/bin/free ]; then
/usr/bin/free -t &gt; $DATE_DIR/free.dump 2&gt;&amp;1
echo -e &quot;.\c&quot;
fi
if [ -r /usr/bin/sar ]; then
/usr/bin/sar &gt; $DATE_DIR/sar.dump 2&gt;&amp;1
echo -e &quot;.\c&quot;
fi
if [ -r /usr/bin/uptime
</code></pre><h3 id="方法三：java工具分析"><a href="#方法三：java工具分析" class="headerlink" title="方法三：java工具分析"></a>方法三：java工具分析</h3><p>Jconsole/JvisualVM/Jprofile/Jmc 等工具对 操作系统(cpu/线程数/内存) 以及jvm分代消耗 gc情况 或 死锁 或 Mbean jmx监控 着手分析</p>
<h2 id="如何进行系统调优"><a href="#如何进行系统调优" class="headerlink" title="如何进行系统调优"></a>如何进行系统调优</h2><h3 id="考虑哪些方面"><a href="#考虑哪些方面" class="headerlink" title="考虑哪些方面"></a>考虑哪些方面</h3><ul>
<li>硬件:<br>  网卡/网络是否通/交换机</li>
<li>操作系统:<br>  负载load/内存mem/swap/io</li>
<li>运行环境软件:<br>  Nginx/Apache/Resin<br>  JVM参数</li>
<li>应用本身<br>  Java程序</li>
</ul>
<pre><code>调查系统现状/寻找性能瓶颈/定位问题
    请求次数
    响应时间
资源消耗：CPU/内存/文件/网络
    确定调优目标
    单机用户量=用户量/机器数
     并发目标：如95%用户500ms响应
定位资源消耗
    -在哪里
        CPU/内存/文件/网络
    -什么类型
        线程调度太频繁
        线程load太高
        Full GC太频繁
        Full GC时间过长
        文件读写太慢、堵塞
定位问题代码
    使用Java工具分析内存、线程
    优化问题代码
    未来：编写高效代码 
</code></pre><h3 id="系统分析"><a href="#系统分析" class="headerlink" title="系统分析"></a>系统分析</h3><blockquote>
<p>cpu消耗分析</p>
</blockquote>
<p>上下文切换：文件IO、网络IO、锁、Sleep<br>运行队列（load）：每个核任务队列，最好1~3<br>利用率（关键指标）：进程、内核、中断处理、IO等待、空闲<br>top命令<br>top按进程显示<br>top –p 29974按进程ID显示<br>top1按核显示<br>topshift+h按线程显示<br>vmstat采样<br>vmstat -1每1秒采样</p>
<p>tsar历史消耗对比</p>
<pre><code>top参数意义
 us用户进程任务：高是线程粒度太大，线程一直处于可运行状态Runabble
     原因1：线程无阻塞、循环、大计算（正则、纯粹大运算）
     原因2：频繁GC(Eden/Old小，新对象占用内存多，YoungGC/Full GC)
定位线程：top -5650shift+h找到线程号26697， 0x6849
       一个线程总占用高： jstack 26697 | grep ‘nid=0x6849’
    多个线程来回切换无法定位：jstack 26697
sy内核线程切换：高是线程太多粒度太小
原因：不断阻塞切换、锁等待、IO等待
定位线程： jstack -l 26697，分析等待状态、锁竞争过多线程
ni为nice改变优先级，id空闲时间
wa等待io：大文件
hi硬件中断：网卡接收数据频繁等
si软件中断

top - 16:57:02 up 98 days,  1:40,  9 users,  load average: 7.71, 9.08, 11.05
Tasks: 279 total,   1 running, 277 sleeping,   0 stopped,   1 zombie
Cpu(s): 27.4%us,  5.1%sy,  0.0%ni, 65.6%id,  1.8%wa,  0.0%hi,  0.0%si,  0.0%st
Mem:  65981472k total, 49901984k used, 16079488k free,  4359276k buffers
Swap:  4192956k total,        0k used,  4192956k free, 23197812k cached
</code></pre><blockquote>
<p>内存消耗分析</p>
</blockquote>
<p>vmstat<br>swpd已用虚拟内存kb：过高表示物理内存不够用<br>原因：JVM内存设置过大，Java线程过多，ByteBuffer过多—-即可定位<br>free空闲物理内存<br>buff用作缓冲内存<br>cache用作缓存内存<br>si每秒从disk读至内存数据量<br>so每秒从内存挟制disk数据量</p>
<pre><code>procs -----------memory---------- ---swap-- -----io---- --system-- -----cpu------
 r  b   swpd   free   buff  cache   si   so    bi    bo   in   cs us sy id wa st
 0  3      0 15973668 4359360 23257704    0    0     0   123    0    0 27  5 66  2  0
 0  2      0 15974188 4359360 23257732    0    0     0  5092 1878 3922  0  0 93  6  0

swap相关：kbswpfree,kbswpused
物理内存：kbmemfree,kbmemused
实际可用=kbmemfree+kbfuffers缓冲+kbcached缓存

10时00分01秒 kbmemfree kbmemused  %memused kbbuffers  kbcached kbswpfree kbswpused  %swpused  kbswpcad
10时10分01秒  18004796  47976676     72.71   4354120  21700168   4192956         0      0.00         0
10时20分01秒  17919088  48062384     72.84   4354152  21746360   4192956         0      0.00         0

top：显示的是实际占用内存=Heap+Stack+Perm+ByteBuffer

vmstat/sar/top对比
sar优点：比vmstat，可分析历史
vmstat/sar弱点：不能分析进程内存，top可以
top弱点：不易分析实际占用内存
</code></pre><blockquote>
<p>文件IO消耗分析</p>
</blockquote>
<p>iostat -x<br>iowait每次IO等待CPU比例，高是因为一直等不到IO<br>原因1：文件读写文件占用时间长，多个线程需要大量写入（如频繁写日志）<br>原因2：磁盘设备处理速度慢<br>原因3：文件系统慢<br>原因4：操作文件太大<br>定位线程：jstack找到runnable中的线程<br>tps每秒IO请求数<br>Blk_read/s每秒读区块数(512byte)<br>Blk_wrtn/s每秒写区块数<br>Blk_read读区块总数<br>Blk_wrtn写区块总数</p>
<pre><code>avg-cpu:  %user   %nice %system %iowait  %steal   %idle
           2.54    0.00    0.55    0.03    0.00   96.87

Device:            tps   Blk_read/s   Blk_wrtn/s   Blk_read   Blk_wrtn
sda              11.17        41.40       417.44  436437014 4400574548
sda1              1.11         0.13        37.17    1356426  391818168
sda2              0.00         0.00         0.00       1424          0
sda3              2.64         1.02        35.43   10714778  373487500
sda4              0.00         0.00         0.00          8          0
sda5              0.65         0.66        23.25    6921378  245057640
sda6              6.78        39.60       321.60  417442456 3390211240

采样iostat -x xvda 3 5
r/s每秒读的请求数
r/s每秒写的请求书
avgqu-sz等待请求队列的平均长度
await每次IO等待时间ms
svctm平均每次设备执行IO操作时间

avg-cpu:  %user   %nice %system %iowait  %steal   %idle
       2.54    0.00    0.55    0.03    0.00   96.87

Device:         rrqm/s   wrqm/s   r/s   w/s   rsec/s   wsec/s avgrq-sz avgqu-sz   await  svctm  %util
sda               0.13    41.63  0.61 10.56    41.39   417.55    41.07     0.03    2.58   0.32   0.36
sda1              0.01     3.54  0.00  1.11     0.13    37.17    33.58     0.00    1.01   0.31   0.03
sda2              0.00     0.00  0.00  0.00     0.00     0.00    54.77     0.00    5.08   4.62   0.00
sda3              0.02     1.81  0.02  2.62     1.02    35.43    13.83     0.00    0.30   0.20   0.05
sda4              0.00     0.00  0.00  0.00     0.00     0.00     2.00     0.00   12.00  12.00   0.00
sda5              0.01     2.29  0.03  0.62     0.66    23.25    36.71     0.00    0.98   0.37   0.02
sda6              0.10    33.99  0.56  6.22    39.59   321.69    53.32     0.03    3.88   0.42   0.28
</code></pre><blockquote>
<p>网络IO消耗分析</p>
</blockquote>
<p>cat /proc/interrupts：查看网卡中断是否均衡分配到各CPU<br>只分配到一个CPU：修改kernel，或用支持MSI-X网卡<br>tcpdump -i eth0 -s 0 -l -w - dst port 11214 | strings | grep test_<br>sar -n ALL 1 2：统计收发包成功失败数量<br>网卡成功接包、发包信息<br>网卡失败接包、发包信息(ping)<br>socket统计信息</p>
<pre><code>18时38分08秒     IFACE   rxpck/s   txpck/s   rxbyt/s   txbyt/s   rxcmp/s   txcmp/s  rxmcst/s
18时38分09秒        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00
18时38分09秒      eth0    581.00    703.00 107914.00  89316.00      0.00      0.00      0.00
18时38分09秒      eth1      8.00      0.00    512.00      0.00      0.00      0.00      0.00
18时38分09秒      usb0      0.00      0.00      0.00      0.00      0.00      0.00      0.00

18时38分08秒     IFACE   rxerr/s   txerr/s    coll/s  rxdrop/s  txdrop/s  txcarr/s  rxfram/s  rxfifo/s  txfifo/s
18时38分09秒        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
18时38分09秒      eth0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
18时38分09秒      eth1      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00
18时38分09秒      usb0      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00      0.00

18时38分08秒    call/s retrans/s    read/s   write/s  access/s  getatt/s
18时38分09秒      0.00      0.00      0.00      0.00      0.00      0.00
</code></pre><h2 id="命令分析"><a href="#命令分析" class="headerlink" title="命令分析"></a>命令分析</h2><p>堆栈分析线程状态(blocked，time_waiting, Waiting)<br>可参考：<a href="http://www.cnblogs.com/zhengyun_ustc/archive/2013/03/18/tda.html" target="_blank" rel="external">http://www.cnblogs.com/zhengyun_ustc/archive/2013/03/18/tda.html</a></p>
<h3 id="线程状态查看"><a href="#线程状态查看" class="headerlink" title="线程状态查看"></a>线程状态查看</h3><p>jstack 21415 | grep -i “java.lang.Thread.State” | sort | uniq -c</p>
<pre><code>13    java.lang.Thread.State: BLOCKED (on object monitor)
 21    java.lang.Thread.State: RUNNABLE
 70    java.lang.Thread.State: TIMED_WAITING (on object monitor)
  4    java.lang.Thread.State: TIMED_WAITING (parking)
  6    java.lang.Thread.State: TIMED_WAITING (sleeping)
 13    java.lang.Thread.State: WAITING (on object monitor)
</code></pre><h3 id="输出jstack日志"><a href="#输出jstack日志" class="headerlink" title="输出jstack日志"></a>输出jstack日志</h3><p>jstack 21415 &gt; jstack.log</p>
<h3 id="查看jstack-BLOCKED状态的锁"><a href="#查看jstack-BLOCKED状态的锁" class="headerlink" title="查看jstack BLOCKED状态的锁"></a>查看jstack BLOCKED状态的锁</h3><p>vim jstack.log</p>
<pre><code>&quot;http--8082-16$1500284796&quot; daemon prio=10 tid=0x00002aabd5f57000 nid=0x5902 waiting for monitor entry [0x0000000043829000]
   java.lang.Thread.State: BLOCKED (on object monitor)
        at java.net.PlainSocketImpl.accept(PlainSocketImpl.java:388)
        - waiting to lock &lt;0x00002aab14c63d10&gt; (a java.net.SocksSocketImpl)
        at java.net.ServerSocket.implAccept(ServerSocket.java:453)
        at java.net.ServerSocket.accept(ServerSocket.java:421)
        at com.caucho.vfs.QServerSocketWrapper.accept(QServerSocketWrapper.java:91)
        at com.caucho.server.port.Port.accept(Port.java:1179)
        at com.caucho.server.port.TcpConnection.run(TcpConnection.java:659)
        at com.caucho.util.ThreadPool$Item.runTasks(ThreadPool.java:743)
        at com.caucho.util.ThreadPool$Item.run(ThreadPool.java:662)
        at java.lang.Thread.run(Thread.java:619)
</code></pre><h3 id="查看锁的状态-0x00002aab14c63d10"><a href="#查看锁的状态-0x00002aab14c63d10" class="headerlink" title="查看锁的状态 0x00002aab14c63d10"></a>查看锁的状态 0x00002aab14c63d10</h3><pre><code>[@zjm_106_165 ~]# cat jstack.log.20160719 | grep 0x00002aab14c63d10
    - waiting to lock &lt;0x00002aab14c63d10&gt; (a java.net.SocksSocketImpl)
    - waiting to lock &lt;0x00002aab14c63d10&gt; (a java.net.SocksSocketImpl)
    - waiting to lock &lt;0x00002aab14c63d10&gt; (a java.net.SocksSocketImpl)
    - waiting to lock &lt;0x00002aab14c63d10&gt; (a java.net.SocksSocketImpl)
    - waiting to lock &lt;0x00002aab14c63d10&gt; (a java.net.SocksSocketImpl)
    - locked &lt;0x00002aab14c63d10&gt; (a java.net.SocksSocketImpl)
    - waiting to lock &lt;0x00002aab14c63d10&gt; (a java.net.SocksSocketImpl)
    - waiting to lock &lt;0x00002aab14c63d10&gt; (a java.net.SocksSocketImpl)
    - waiting to lock &lt;0x00002aab14c63d10&gt; (a java.net.SocksSocketImpl)
</code></pre><h2 id="工具使用"><a href="#工具使用" class="headerlink" title="工具使用"></a>工具使用</h2><h3 id="tsar"><a href="#tsar" class="headerlink" title="tsar"></a>tsar</h3><h3 id="iftop"><a href="#iftop" class="headerlink" title="iftop"></a>iftop</h3>
      
    </div>

    <div>
      
        
      
    </div>

    <div>
      
        

      
    </div>

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/JVM/" rel="tag">#JVM</a>
          
            <a href="/tags/hotspot/" rel="tag">#hotspot</a>
          
        </div>
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2016/08/05/(8.6).JAVA虚拟机(六)-JMM内存模型/" rel="next" title="JMM内存模型">
                <i class="fa fa-chevron-left"></i> JMM内存模型
              </a>
            
          </div>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2017/08/11/9.4) redis运维-升级redis密码过程/" rel="prev" title="cachecloud在线升级密码过程">
                cachecloud在线升级密码过程 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
        
<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='http://bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/metor.ico"
               alt="Pedestrian" />
          <p class="site-author-name" itemprop="name">Pedestrian</p>
          <p class="site-description motion-element" itemprop="description">study for goal</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">38</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">24</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">50</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yanan0628" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://carlosfu.github.io/" target="_blank" title="fudada">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  fudada
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://jolinzhangg.github.io/" target="_blank" title="xiaodada">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  xiaodada
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
            
              
            
            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#JVM常见问题及性能分析"><span class="nav-number">1.</span> <span class="nav-text">JVM常见问题及性能分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#方法一：GC-log"><span class="nav-number">1.1.</span> <span class="nav-text">方法一：GC log</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法二：jdk自带命令"><span class="nav-number">1.2.</span> <span class="nav-text">方法二：jdk自带命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#方法三：java工具分析"><span class="nav-number">1.3.</span> <span class="nav-text">方法三：java工具分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何进行系统调优"><span class="nav-number">2.</span> <span class="nav-text">如何进行系统调优</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#考虑哪些方面"><span class="nav-number">2.1.</span> <span class="nav-text">考虑哪些方面</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#系统分析"><span class="nav-number">2.2.</span> <span class="nav-text">系统分析</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#命令分析"><span class="nav-number">3.</span> <span class="nav-text">命令分析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#线程状态查看"><span class="nav-number">3.1.</span> <span class="nav-text">线程状态查看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#输出jstack日志"><span class="nav-number">3.2.</span> <span class="nav-text">输出jstack日志</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看jstack-BLOCKED状态的锁"><span class="nav-number">3.3.</span> <span class="nav-text">查看jstack BLOCKED状态的锁</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#查看锁的状态-0x00002aab14c63d10"><span class="nav-number">3.4.</span> <span class="nav-text">查看锁的状态 0x00002aab14c63d10</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#工具使用"><span class="nav-number">4.</span> <span class="nav-text">工具使用</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#tsar"><span class="nav-number">4.1.</span> <span class="nav-text">tsar</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#iftop"><span class="nav-number">4.2.</span> <span class="nav-text">iftop</span></a></li></ol></li></ol></div>
            
          </div>
        </section>
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Pedestrian</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.0.1"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.0.1"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  

</body>
</html>
