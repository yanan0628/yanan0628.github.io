<!doctype html>



  


<html class="theme-next mist use-motion">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/vendors/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/vendors/font-awesome/css/font-awesome.min.css?v=4.4.0" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.0.1" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.0.1" />






<meta name="description" content="study for goal">
<meta property="og:type" content="website">
<meta property="og:title" content="Meteor">
<meta property="og:url" content="/index.html">
<meta property="og:site_name" content="Meteor">
<meta property="og:description" content="study for goal">
<meta property="og:locale" content="zh-Hans">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Meteor">
<meta name="twitter:description" content="study for goal">



<script type="text/javascript" id="hexo.configuration">
  var NexT = window.NexT || {};
  var CONFIG = {
    scheme: 'Mist',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: 0,
      author: '博主'
    }
  };
</script>

  <title> Meteor </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Meteor</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle"></p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="#" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup">
 <span class="search-icon fa fa-search"></span>
 <input type="text" id="local-search-input">
 <div id="local-search-result"></div>
 <span class="popup-btn-close">close</span>
</div>


    </div>
  
</nav>

 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/26/9.7)redis热点key问题排查/" itemprop="url">
                  redis 热点key排查
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-26T11:00:35+08:00" content="2017-10-26">
              2017-10-26
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/redis/" itemprop="url" rel="index">
                    <span itemprop="name">redis</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="网络输入-输出流量问题排查"><a href="#网络输入-输出流量问题排查" class="headerlink" title="网络输入/输出流量问题排查"></a>网络输入/输出流量问题排查</h2><h3 id="流量影响"><a href="#流量影响" class="headerlink" title="流量影响"></a>流量影响</h3><p>现在公司用的是千兆网卡(bit)，换算流量最大阈值125MB左右，如果当前机器网络流量过大(redis在数据流入/流出会消耗大量流量)，当出现打满机器的网卡流量，就会造成当前机器的丢包或拥塞。会影响当前机器所有redis实例的访问和结果返回。</p>
<p>有以下几种情况:</p>
<ul>
<li>bigkey大对象,慢查询分析.比如:每秒50次get操作1M的对象（输出流量 50M/s）</li>
<li>ops暴增，比如:正常ops get操作200次,突然增到2000甚至更高,流量*10倍</li>
<li>ops增长不明显,慢查询也没有.可能有热点key流量都访问该redis实例(检查ops和instantaneous_output_kbps情况)</li>
</ul>
<h3 id="排查步骤"><a href="#排查步骤" class="headerlink" title="排查步骤"></a>排查步骤</h3><ul>
<li>1.先看应用是否有慢查询,大对象访问造成流量过高  </li>
<li>2.当前redis命令ops(如果是cluster 对比其他master节点)  </li>
<li>3.热点key分析  到服务器本地执行最近1分钟monitor命令  </li>
<li>4.facebook工具或脚本分析当前 热点command以及热点key</li>
<li>5.按ip 频次 key进行排序</li>
<li>6.计算每个ip key 对应流量 value*频次 </li>
<li>7.提供给客户端排查key 客户端ip 占用流量情况</li>
</ul>
<h3 id="工具排查"><a href="#工具排查" class="headerlink" title="工具排查"></a>工具排查</h3><ul>
<li><p>执行monitor命令导出文件</p>
</li>
<li><p>执行facebook脚本</p>
</li>
</ul>
<p><code>redis-faina.py</code>脚本:<a href="https://github.com/facebookarchive/redis-faina" target="_blank" rel="external">redis-faina使用方法</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div></pre></td><td class="code"><pre><div class="line">localhos:log chenshi$ ./redis-faina.py 78.41:6382.log</div><div class="line">Overall Stats</div><div class="line">========================================</div><div class="line">Lines Processed  	33072</div><div class="line">Commands/Sec     	1203.72</div><div class="line"></div><div class="line">Top Prefixes</div><div class="line">========================================</div><div class="line">m             	9480	(28.66%)</div><div class="line">p             	7963	(24.08%)</div><div class="line">pcl           	4511	(13.64%)</div><div class="line">card          	3468	(10.49%)</div><div class="line">catecodeinfo  	1698	(5.13%)</div><div class="line">pclcates      	257 	(0.78%)</div><div class="line">pcluser       	150 	(0.45%)</div><div class="line">pclcatef      	129 	(0.39%)</div><div class="line"></div><div class="line">Top Keys</div><div class="line">========================================</div><div class="line">m:pcl:pad:fircate:73  	8159	(24.67%)</div><div class="line">catecodeinfo:tag:v2   	1698	(5.13%)</div><div class="line">card:56:92655095,2    	1007	(3.04%)</div><div class="line">card:56:92400031,2    	879 	(2.66%)</div><div class="line">pcl:pad:seccate:60    	578 	(1.75%)</div><div class="line">pcl:pad:seccate:82    	541 	(1.64%)</div><div class="line">p:v:ee:92469530,2     	518 	(1.57%)</div><div class="line">p:s:sort:20171025:22  	426 	(1.29%)</div><div class="line"></div><div class="line">Top Commands</div><div class="line">========================================</div><div class="line">GET      	29435	(89.00%)</div><div class="line">SETEX    	3411 	(10.31%)</div><div class="line">TTL      	217  	(0.66%)</div><div class="line">HGETALL  	8    	(0.02%)</div><div class="line"></div><div class="line">Command Time (microsecs)</div><div class="line">========================================</div><div class="line">Median  	432.75</div><div class="line">75%     	1079.0</div><div class="line">90%     	2150.0</div><div class="line">99%     	5313.0</div><div class="line"></div><div class="line">Heaviest Commands (microsecs)</div><div class="line">========================================</div><div class="line">GET      	23233082.75</div><div class="line">SETEX    	3999394.75</div><div class="line">TTL      	229730.25</div><div class="line">HGETALL  	12561.25</div><div class="line"></div><div class="line">Slowest Calls</div><div class="line">========================================</div><div class="line">17639.0   	&quot;GET&quot; &quot;RVF#93579800,2&quot;</div><div class="line">16154.0   	&quot;SETEX&quot; &quot;p:v:ms:90570158,2&quot; &quot;86400&quot; &quot;2.5&quot;</div><div class="line">16146.0   	&quot;GET&quot; &quot;m:pcl:pad:topic:12540&quot;</div><div class="line">15166.0   	&quot;SETEX&quot; &quot;RG#93445677#2&quot; &quot;86400&quot; &quot;[&#123;\&quot;name\&quot;:\&quot;93445677,2\&quot;,\&quot;score\&quot;:0.01129842,\&quot;tag\&quot;:\&quot;\xe6\xbe\xa1\xe5\xa0\x82\&quot;&#125;]&quot;</div><div class="line">14765.0   	&quot;GET&quot; &quot;m:pcl:pad:fircate:73&quot;</div><div class="line">14495.0   	&quot;GET&quot; &quot;catecodeinfo:tag:v2&quot;</div><div class="line">12783.0   	&quot;GET&quot; &quot;p:v:ee:93842379,2&quot;</div><div class="line">11970.25  	&quot;GET&quot; &quot;m:pcl:pad:fircate:73&quot;</div></pre></td></tr></table></figure>
<ul>
<li>commands比例和top keys需要重点排查</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">Top Commands</div><div class="line">========================================</div><div class="line">GET      	29435	(89.00%)</div><div class="line"></div><div class="line">Top Keys</div><div class="line">========================================</div><div class="line">m:pcl:pad:fircate:73  	8159	(24.67%)</div><div class="line">catecodeinfo:tag:v2   	1698	(5.13%)</div><div class="line">card:56:92655095,2    	1007	(3.04%)</div><div class="line">card:56:92400031,2    	879 	(2.66%)</div><div class="line">pcl:pad:seccate:60    	578 	(1.75%)</div><div class="line">pcl:pad:seccate:82    	541 	(1.64%)</div><div class="line">p:v:ee:92469530,2     	518 	(1.57%)</div><div class="line">p:s:sort:20171025:22  	426 	(1.29%)</div></pre></td></tr></table></figure>
<ul>
<li>get命令top20</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat 78.41:6382.log | grep GET | awk &apos;&#123;print $5&#125;&apos;  | sort | uniq -c | sort -rn | head -20</div></pre></td></tr></table></figure>
<ul>
<li>debug object查看key值大小</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">*.*.78.41:6382&gt; DEBUG OBJECT catecodeinfo:tag:v2</div><div class="line">Value at:0x7fa68584e230 refcount:1 encoding:raw serializedlength:840478 lru:15826073 lru_seconds_idle:549</div></pre></td></tr></table></figure>
<ul>
<li>客户端ip调用情况</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">cat 78.41:6382.log | grep GET | awk &apos;&#123;print $3&quot;=&gt;&quot;$5&#125;&apos; | grep &quot;catecodeinfo:tag:v2&quot; | sort | uniq -c | sort -rn | head -20</div></pre></td></tr></table></figure>
<h2 id="案例分析"><a href="#案例分析" class="headerlink" title="案例分析"></a>案例分析</h2><h3 id="现象"><a href="#现象" class="headerlink" title="现象"></a>现象</h3><ul>
<li><strong>redis报警信息</strong></li>
</ul>
<p><img src="http://i3.itc.cn/20171026/aac_a468f656_656f_f25f_0ff6_7493b7f9956d_1.png" alt=""></p>
<ul>
<li><strong>info stat快照</strong>(*.78.41 <code>redis实例流量报警快照</code>)</li>
</ul>
<p><img src="http://i1.itc.cn/20171026/aac_a468f656_656f_f25f_0ff6_7493b7f9956d_2.png" alt=""></p>
<p>当前ops：1637 当前网络输出流量:67.4M (千兆网卡流量120MB/s)</p>
<ul>
<li><strong>info stat快照</strong>(*.78.41 <code>redis正常时间实例流量快照</code>)</li>
</ul>
<p><img src="http://i1.itc.cn/20171026/aac_a468f656_656f_f25f_0ff6_7493b7f9956d_3.png" alt=""></p>
<h3 id="分析"><a href="#分析" class="headerlink" title="分析"></a>分析</h3><ul>
<li>1.快照分析 </li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">1.通过分析正常/流量报警快照，redis实例的基础统计信息 ops/instantaneous_output_kbps</div><div class="line">2.流量高的时候也可以对比下其他master节点的ops/instantaneous_output_kbps</div><div class="line">3.正常时候ops更高，但输出流量更小。ops低的时候流量高反而流量大，但并没有产生慢查询(&gt;10ms请求)</div><div class="line">4.基本确定有大对象访问</div></pre></td></tr></table></figure>
<ul>
<li>2.执行minitor导出文件</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">1.上redis服务器执行monitor(报警期间)最近一分钟/最近10000执行命令分析。</div><div class="line">redis-cli -p 6382 -a *** monitor | head -n 100000 &gt; 78.41:6382.log</div></pre></td></tr></table></figure>
<ul>
<li>3.分析当前command操作占比以及top20情况</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div></pre></td><td class="code"><pre><div class="line">get调用占比较高</div><div class="line">Top Commands</div><div class="line">========================================</div><div class="line">GET      	29435	(89.00%)</div><div class="line">SETEX    	3411 	(10.31%)</div><div class="line">TTL      	217  	(0.66%)</div><div class="line">HGETALL  	8    	(0.02%)</div><div class="line"></div><div class="line">localhos:log chenshi$ cat 78.41:6382.log | grep GET | awk &apos;&#123;print $5&#125;&apos;  | sort | uniq -c | sort -rn | head -20</div><div class="line">8159 &quot;m:pcl:pad:fircate:73&quot;</div><div class="line">1698 &quot;catecodeinfo:tag:v2&quot;</div><div class="line">1007 &quot;card:56:92655095,2&quot;</div><div class="line"> 879 &quot;card:56:92400031,2&quot;</div><div class="line"> 578 &quot;pcl:pad:seccate:60&quot;</div><div class="line"> 541 &quot;pcl:pad:seccate:82&quot;</div><div class="line"> 518 &quot;p:v:ee:92469530,2&quot;</div><div class="line"> 375 &quot;p:v:ee:92760970,2&quot;</div><div class="line"> 264 &quot;p:v:ee:92414925,2&quot;</div><div class="line"> 264 &quot;card:56:92785886,2&quot;</div><div class="line"> 213 &quot;p:s:sort:20171025:22&quot;</div><div class="line"> 163 &quot;pcl:pad:user:306132492&quot;</div><div class="line"> 161 &quot;p:v:ee:92200421,2&quot;</div><div class="line"> 149 &quot;pcl:pad:topic:12540&quot;</div><div class="line"> 149 &quot;pcl:pad:topic:12020&quot;</div><div class="line"> 149 &quot;m:pcl:pad:topic:12540&quot;</div><div class="line"> 134 &quot;pclcates:56:10080:1&quot;</div><div class="line"> 132 &quot;pcl:pad:seccate:11531&quot;</div><div class="line"> 120 &quot;pcl:pad:topic:10228&quot;</div><div class="line"> 120 &quot;m:pcl:pad:topic:10228&quot;</div><div class="line">``` </div><div class="line"> </div><div class="line">- 4.key产生流量分析,找出大对象</div></pre></td></tr></table></figure>
<p>扫描结果如下：<br>card:56:92785886,2: 264(次)<em>106(字节) =27 kb<br>p:v:ee:92469530,2: 518(次)</em>33(字节) =17 kb<br>p:v:ee:92414925,2: 264(次)<em>34(字节) =8 kb<br>card:56:92655095,2: 1007(次)</em>106(字节) =106 kb<br>card:56:92400031,2: 879(次)<em>106(字节) =93 kb<br>p:v:ee:92760970,2: 375(次)</em>32(字节) =12 kb<br>pclcates:56:10080:1: 134(次)<em>629(字节) =84 kb<br>catecodeinfo:tag:v2: 1698(次)</em>840478(字节) =1427131 kb<br>p:v:ee:92200421,2: 161(次)<em>33(字节) =5 kb<br>p:s:sort:20171025:22: 213(次)</em>16(字节) =3 kb</p>
<p><em>.</em>.78.41:6382&gt; DEBUG OBJECT catecodeinfo:tag:v2<br>Value at:0x7fa5be68c0a0 refcount:1 encoding:raw serializedlength:840844 lru:15816789 lru_seconds_idle:165<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"></div><div class="line">- 5.分析大对象key所有客户端ip执行GET调用情况</div></pre></td></tr></table></figure></p>
<p>localhos:log chenshi$ cat 78.41:6382.log | grep GET | awk ‘{print $3”=&gt;”$5}’ | grep “catecodeinfo:tag:v2” | sort | uniq -c | sort -rn | head -20<br> 420 10.23.194.5:37363]=&gt;”catecodeinfo:tag:v2”<br> 377 10.23.194.6:41135]=&gt;”catecodeinfo:tag:v2”<br> 132 192.168.42.26:35184]=&gt;”catecodeinfo:tag:v2”<br>  64 10.23.194.2:37984]=&gt;”catecodeinfo:tag:v2”<br>  60 10.23.194.6:33715]=&gt;”catecodeinfo:tag:v2”<br>  56 10.23.194.3:48388]=&gt;”catecodeinfo:tag:v2”<br>  54 192.168.42.30:42056]=&gt;”catecodeinfo:tag:v2”<br>  54 10.23.194.2:52091]=&gt;”catecodeinfo:tag:v2”<br>  50 10.23.194.4:37498]=&gt;”catecodeinfo:tag:v2”<br>  46 10.23.194.5:59113]=&gt;”catecodeinfo:tag:v2”<br>  42 192.168.42.23:57718]=&gt;”catecodeinfo:tag:v2”<br>```</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/25/9.6)redis运维列表/" itemprop="url">
                  redis原理和cachecloud运维目录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-25T16:37:35+08:00" content="2017-10-25">
              2017-10-25
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/redis/" itemprop="url" rel="index">
                    <span itemprop="name">redis</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/redis/cachecloud/" itemprop="url" rel="index">
                    <span itemprop="name">cachecloud</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="redis原理"><a href="#redis原理" class="headerlink" title="redis原理"></a>redis原理</h1><h1 id="cachecloud运维"><a href="#cachecloud运维" class="headerlink" title="cachecloud运维"></a>cachecloud运维</h1>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/24/9.6) jedispool连接池总结/" itemprop="url">
                  jedispool总结
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-24T10:33:00+08:00" content="2017-10-24">
              2017-10-24
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/redis/" itemprop="url" rel="index">
                    <span itemprop="name">redis</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/redis/连接池/" itemprop="url" rel="index">
                    <span itemprop="name">连接池</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <p>apache对象池:<a href="http://commons.apache.org/proper/commons-pool/" target="_blank" rel="external">对象池</a></p>
<h2 id="对象池"><a href="#对象池" class="headerlink" title="对象池"></a>对象池</h2><p>我们常用的池子像 数据库连接池、jedis连接池、线程池等，查看源码会发现这些池管理类都是继承于GenericObjectPool<t>，所以我们需要了解下GenericObjectPool的工作机制。</t></p>
<p>对象池的类图:<br><img src="http://img.blog.csdn.net/20160501212832585?watermark/2/text/aHR0cDovL2Jsb2cuY3Nkbi5uZXQv/font/5a6L5L2T/fontsize/400/fill/I0JBQkFCMA==/dissolve/70/gravity/Center" alt="类图"></p>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/10/24/9.6) jedispool连接池总结/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/22/10.4).netflix-atlas使用/" itemprop="url">
                  altas指标监控平台使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-22T10:11:00+08:00" content="2017-10-22">
              2017-10-22
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/altas/" itemprop="url" rel="index">
                    <span itemprop="name">altas</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="grafana安装"><a href="#grafana安装" class="headerlink" title="grafana安装"></a>grafana安装</h2><h2 id="altas收集"><a href="#altas收集" class="headerlink" title="altas收集"></a>altas收集</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/21/10.3) springcloud-rpc使用/" itemprop="url">
                  springcloud rpc使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-21T10:11:00+08:00" content="2017-10-21">
              2017-10-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/ribbon/" itemprop="url" rel="index">
                    <span itemprop="name">ribbon</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/ribbon/fegin/" itemprop="url" rel="index">
                    <span itemprop="name">fegin</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/ribbon/fegin/resttemplate/" itemprop="url" rel="index">
                    <span itemprop="name">resttemplate</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Ribbon"><a href="#Ribbon" class="headerlink" title="Ribbon"></a>Ribbon</h2><p>ribbon是基于客户端的一个负载均衡器。</p>
<p>当Ribbon与Eureka联合使用时，ribbonServerList会被DiscoveryEnabledNIWSServerList重写，扩展成从Eureka注册中心中获取服务端列表。同时它也会用NIWSDiscoveryPing来取代IPing，它将职责委托给Eureka来确定服务端是否已经启动。</p>
<h2 id="RestTemplate"><a href="#RestTemplate" class="headerlink" title="RestTemplate"></a>RestTemplate</h2><h2 id="feign"><a href="#feign" class="headerlink" title="feign"></a>feign</h2>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/21/10.4) netflix-hystrix熔断/" itemprop="url">
                  hystrix使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-21T10:11:00+08:00" content="2017-10-21">
              2017-10-21
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/hystrix/" itemprop="url" rel="index">
                    <span itemprop="name">hystrix</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="hystrix-dashboard使用"><a href="#hystrix-dashboard使用" class="headerlink" title="hystrix-dashboard使用"></a>hystrix-dashboard使用</h2><h3 id="搭建dashboard"><a href="#搭建dashboard" class="headerlink" title="搭建dashboard"></a>搭建dashboard</h3><ul>
<li>直接启动</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ git clone https://github.com/Netflix/Hystrix.git</div><div class="line">$ cd Hystrix/hystrix-dashboard</div><div class="line">$ ../gradlew appRun</div></pre></td></tr></table></figure>
<p><code>dashboard地址:</code><a href="http://localhost:7979/hystrix-dashboard" target="_blank" rel="external">http://localhost:7979/hystrix-dashboard</a></p>
<ul>
<li>后台启动</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">java -jar -DserverPort=8080 -DbindAddress=192.168.1.100 standalone-hystrix-dashboard-&#123;VERSION&#125;-all.jar</div><div class="line"></div><div class="line">serverPort	The port that the server will listen to.   7979</div><div class="line">bindAddress	The address that the server will bind to.  0.0.0.0</div><div class="line">disableCompression	Flag to disable compression support for the metrics stream. enable</div></pre></td></tr></table></figure>
<h3 id="dashboard配置"><a href="#dashboard配置" class="headerlink" title="dashboard配置"></a>dashboard配置</h3><p><code>hystrix-dashboard后台</code>:<a href="http://127.0.0.1:7979/hystrix-dashboard/" target="_blank" rel="external">http://127.0.0.1:7979/hystrix-dashboard/</a></p>
<p><img src="http://i3.itc.cn/20171024/aac_12264e27_e85d_67d4_bc49_5db5c608fa7f_2.png" alt=""></p>
<p><code>客户端数据流</code>:<a href="http://10.7.36.64:7771/hystrix.stream" target="_blank" rel="external">http://10.7.36.64:7771/hystrix.stream</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">data: &#123;&quot;type&quot;:&quot;HystrixCommand&quot;,&quot;name&quot;:&quot;getTime&quot;,&quot;group&quot;:&quot;RestServiceImpl&quot;,&quot;currentTime&quot;:1508827134796,&quot;isCircuitBreakerOpen&quot;:false,&quot;errorPercentage&quot;:0,&quot;errorCount&quot;:0,&quot;requestCount&quot;:0,&quot;rollingCountBadRequests&quot;:0,&quot;rollingCountCollapsedRequests&quot;:0,&quot;rollingCountEmit&quot;:0,&quot;rollingCountExceptionsThrown&quot;:0,&quot;rollingCountFailure&quot;:0,&quot;rollingCountFallbackEmit&quot;:0,&quot;rollingCountFallbackFailure&quot;:0,&quot;rollingCountFallbackMissing&quot;:0,&quot;rollingCountFallbackRejection&quot;:0,&quot;rollingCountFallbackSuccess&quot;:0,&quot;rollingCountResponsesFromCache&quot;:0,&quot;rollingCountSemaphoreRejected&quot;:0,&quot;rollingCountShortCircuited&quot;:0,&quot;rollingCountSuccess&quot;:0,&quot;rollingCountThreadPoolRejected&quot;:0,&quot;rollingCountTimeout&quot;:0,&quot;currentConcurrentExecutionCount&quot;:0,&quot;rollingMaxConcurrentExecutionCount&quot;:0,&quot;latencyExecute_mean&quot;:0,&quot;latencyExecute&quot;:&#123;&quot;0&quot;:0,&quot;25&quot;:0,&quot;50&quot;:0,&quot;75&quot;:1,&quot;90&quot;:1,&quot;95&quot;:1,&quot;99&quot;:1,&quot;99.5&quot;:1,&quot;100&quot;:1&#125;,&quot;latencyTotal_mean&quot;:0,&quot;latencyTotal&quot;:&#123;&quot;0&quot;:0,&quot;25&quot;:0,&quot;50&quot;:0,&quot;75&quot;:1,&quot;90&quot;:1,&quot;95&quot;:1,&quot;99&quot;:1,&quot;99.5&quot;:1,&quot;100&quot;:1&#125;,&quot;propertyValue_circuitBreakerRequestVolumeThreshold&quot;:20,&quot;propertyValue_circuitBreakerSleepWindowInMilliseconds&quot;:5000,&quot;propertyValue_circuitBreakerErrorThresholdPercentage&quot;:50,&quot;propertyValue_circuitBreakerForceOpen&quot;:false,&quot;propertyValue_circuitBreakerForceClosed&quot;:false,&quot;propertyValue_circuitBreakerEnabled&quot;:true,&quot;propertyValue_executionIsolationStrategy&quot;:&quot;THREAD&quot;,&quot;propertyValue_executionIsolationThreadTimeoutInMilliseconds&quot;:1000,&quot;propertyValue_executionTimeoutInMilliseconds&quot;:1000,&quot;propertyValue_executionIsolationThreadInterruptOnTimeout&quot;:true,&quot;propertyValue_executionIsolationThreadPoolKeyOverride&quot;:null,&quot;propertyValue_executionIsolationSemaphoreMaxConcurrentRequests&quot;:10,&quot;propertyValue_fallbackIsolationSemaphoreMaxConcurrentRequests&quot;:10,&quot;propertyValue_metricsRollingStatisticalWindowInMilliseconds&quot;:10000,&quot;propertyValue_requestCacheEnabled&quot;:true,&quot;propertyValue_requestLogEnabled&quot;:true,&quot;reportingHosts&quot;:1,&quot;threadPool&quot;:&quot;RestServiceImpl&quot;&#125;</div><div class="line">data: &#123;&quot;type&quot;:&quot;HystrixThreadPool&quot;,&quot;name&quot;:&quot;RestServiceImpl&quot;,&quot;currentTime&quot;:1508827134796,&quot;currentActiveCount&quot;:0,&quot;currentCompletedTaskCount&quot;:5,&quot;currentCorePoolSize&quot;:10,&quot;currentLargestPoolSize&quot;:5,&quot;currentMaximumPoolSize&quot;:10,&quot;currentPoolSize&quot;:5,&quot;currentQueueSize&quot;:0,&quot;currentTaskCount&quot;:5,&quot;rollingCountThreadsExecuted&quot;:0,&quot;rollingMaxActiveThreads&quot;:0,&quot;rollingCountCommandRejections&quot;:0,&quot;propertyValue_queueSizeRejectionThreshold&quot;:5,&quot;propertyValue_metricsRollingStatisticalWindowInMilliseconds&quot;:10000,&quot;reportingHosts&quot;:1&#125;</div><div class="line">....</div></pre></td></tr></table></figure>
<p><code>开启monitor</code></p>
<p><img src="http://i2.itc.cn/20171024/aac_12264e27_e85d_67d4_bc49_5db5c608fa7f_1.png" alt=""></p>
<h2 id="hystrix客户端配置"><a href="#hystrix客户端配置" class="headerlink" title="hystrix客户端配置"></a>hystrix客户端配置</h2><ul>
<li>pom依赖</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"> &lt;!-- hystrix --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-cloud-starter-hystrix&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<ul>
<li>启动类注解 @EnableCircuitBreaker</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@SpringBootApplication</span></div><div class="line"><span class="meta">@EnableDiscoveryClient</span></div><div class="line"><span class="meta">@EnableFeignClients</span></div><div class="line"><span class="meta">@EnableCircuitBreaker</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ClientApplication</span> </span>&#123;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</div><div class="line">        <span class="keyword">new</span> SpringApplication().run(ClientApplication.class,args);</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="meta">@Bean</span></div><div class="line">    <span class="meta">@LoadBalanced</span></div><div class="line">    <span class="function">RestTemplate <span class="title">restTemplate</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="keyword">new</span> RestTemplate();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>service配置hystrix降级 @HystrixCommand</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="meta">@Service</span></div><div class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestServiceImpl</span> <span class="keyword">implements</span> <span class="title">RestService</span></span>&#123;</div><div class="line"></div><div class="line">    <span class="meta">@Autowired</span></div><div class="line">    RestTemplate restTemplate;</div><div class="line"></div><div class="line">    <span class="meta">@HystrixCommand</span>(fallbackMethod = <span class="string">"getTimeFallback"</span>)</div><div class="line">    <span class="meta">@Override</span></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTime</span><span class="params">()</span> </span>&#123;</div><div class="line">        <span class="keyword">return</span> restTemplate.getForEntity(<span class="string">"http://test.server1/get"</span>,String.class).getBody();</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTimeFallback</span><span class="params">()</span></span>&#123;</div><div class="line">        <span class="keyword">return</span> <span class="string">"fallback return : 2017-10-24 00:00:00"</span>;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>结果调试</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">http://10.7.36.64:7771/c3/get</div><div class="line"></div><div class="line">正常返回:s1client execute get 1,time=1508829619207</div><div class="line">降级返回:fallback return : 2017-10-24 00:00:00</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/20/10.2) springcloud-eureka使用/" itemprop="url">
                  spring eureka使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-10-20T10:11:00+08:00" content="2017-10-20">
              2017-10-20
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/eureka/" itemprop="url" rel="index">
                    <span itemprop="name">eureka</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="euraka-server"><a href="#euraka-server" class="headerlink" title="euraka server"></a>euraka server</h2><h3 id="构建erueka注册中心"><a href="#构建erueka注册中心" class="headerlink" title="构建erueka注册中心"></a>构建erueka注册中心</h3><ul>
<li>1.pom依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.cloud<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">	<span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-cloud-starter-eureka-server<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></div></pre></td></tr></table></figure>
<ul>
<li>2.eureka服务启动类 ServerApplication</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">package com.sohu.index.springcloud.learn;</div><div class="line"></div><div class="line">import org.springframework.boot.SpringApplication;</div><div class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</div><div class="line">import org.springframework.cloud.netflix.eureka.server.EnableEurekaServer;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by chenshi on 2017/10/20.</div><div class="line"> */</div><div class="line">@SpringBootApplication</div><div class="line">@EnableEurekaServer</div><div class="line">public class ServerApplication &#123;</div><div class="line"></div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        new SpringApplication().run(ServerApplication.class,args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>3.application.yml配置文件</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"><span class="attr">server:</span></div><div class="line"><span class="attr">  port:</span> <span class="number">9191</span></div><div class="line"><span class="attr">eureka:</span></div><div class="line"><span class="attr">  client:</span></div><div class="line"><span class="attr">    register-with-eureka:</span> <span class="literal">false</span></div><div class="line"><span class="attr">    fetch-registry:</span> <span class="literal">false</span></div><div class="line"><span class="attr">    service-url:</span></div><div class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://localhost:$&#123;server.port&#125;/eureka/</span></div></pre></td></tr></table></figure>
<ul>
<li>4.启动服务</li>
</ul>
<p>eureka地址:<a href="http://127.0.0.1:9191/" target="_blank" rel="external">http://127.0.0.1:9191/</a>    </p>
<h3 id="eureka注册中心权限"><a href="#eureka注册中心权限" class="headerlink" title="eureka注册中心权限"></a>eureka注册中心权限</h3><ul>
<li>1.pom依赖</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">&lt;dependency&gt;</div><div class="line">	&lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">	&lt;artifactId&gt;spring-boot-starter-security&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<ul>
<li>2.全局配置bootstrap.yml</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">security:</div><div class="line">    basic:</div><div class="line">      enabled: true</div><div class="line">    user:</div><div class="line">      name: admin</div><div class="line">      password: 123</div></pre></td></tr></table></figure>
<h2 id="eureka-client"><a href="#eureka-client" class="headerlink" title="eureka client"></a>eureka client</h2><h3 id="客户端服务注册"><a href="#客户端服务注册" class="headerlink" title="客户端服务注册"></a>客户端服务注册</h3><ul>
<li>1.pom依赖</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">&lt;!-- eureka client --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.cloud&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-cloud-starter-eureka&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
<ul>
<li>2.启动类ClientApplication</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">package com.sohu.index.springcloud.learn;</div><div class="line"></div><div class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</div><div class="line">import org.springframework.boot.builder.SpringApplicationBuilder;</div><div class="line">import org.springframework.cloud.client.discovery.EnableDiscoveryClient;</div><div class="line"></div><div class="line">/**</div><div class="line"> * Created by chenshi on 2017/8/9.</div><div class="line"> */</div><div class="line">@SpringBootApplication</div><div class="line">@EnableDiscoveryClient</div><div class="line">public class ClientAppllication &#123;</div><div class="line"></div><div class="line">    public static void main(String[] args) &#123;</div><div class="line">        new SpringApplicationBuilder(ClientAppllication.class).web(true).run(args);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<ul>
<li>3.application.yml配置</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line"><span class="attr">spring:</span></div><div class="line"><span class="attr">  application:</span></div><div class="line"><span class="attr">    name:</span> <span class="string">test.client1</span></div><div class="line"><span class="attr">server:</span></div><div class="line"><span class="attr">  port:</span> <span class="number">8881</span></div><div class="line"><span class="attr">eureka:</span></div><div class="line"><span class="attr">  client:</span></div><div class="line"><span class="attr">    service-url:</span></div><div class="line"><span class="attr">      defaultZone:</span> <span class="attr">http://127.0.0.1:9191/eureka/</span></div></pre></td></tr></table></figure>
<ul>
<li><p>4.web服务相关配置</p>
<ul>
<li><p>pom依赖</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">&lt;!-- web --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div><div class="line"></div><div class="line">&lt;!-- actuator端点 info env  --&gt;</div><div class="line">&lt;dependency&gt;</div><div class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">    &lt;artifactId&gt;spring-boot-starter-actuator&lt;/artifactId&gt;</div><div class="line">&lt;/dependency&gt;</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
<pre><code>- 相关端点

<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">系统环境:http://10.7.36.64:8881/env</div><div class="line">自动配置:http://10.7.36.64:8881/autoconfig</div></pre></td></tr></table></figure>
</code></pre>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/09/18/10.1).spring-boot使用/" itemprop="url">
                  spring boot使用和接入
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-09-18T16:37:35+08:00" content="2017-09-18">
              2017-09-18
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/springboot/" itemprop="url" rel="index">
                    <span itemprop="name">springboot</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/springboot/springcloud/" itemprop="url" rel="index">
                    <span itemprop="name">springcloud</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="spring-boot使用和接入"><a href="#spring-boot使用和接入" class="headerlink" title="spring boot使用和接入"></a>spring boot使用和接入</h1><p>参考：<a href="https://qbgbook.gitbooks.io/spring-boot-reference-guide-zh/content/III.%20Using%20Spring%20Boot/" target="_blank" rel="external">spring boot中文wiki</a><br><a href="http://www.cnblogs.com/renhui/p/5910300.html" target="_blank" rel="external">annotation</a></p>
<h2 id="spring-boot优势"><a href="#spring-boot优势" class="headerlink" title="spring boot优势"></a>spring boot优势</h2><ol>
<li>boot项目把容器打到jar包，可以通过java -jar *.jar启动一个web/</li>
<li>可将服务配置成系统级别启动/停止，只依赖操作系统和jdk</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">sudo ln -s $&#123;path&#125;/*.jar /etc/init.d/$&#123;服务名&#125;</div><div class="line">chmod 700 /etc/init.d/$&#123;服务名&#125;</div><div class="line">echo &quot;renew /etc/init.d/$&#123;服务名&#125;&quot;</div></pre></td></tr></table></figure>
<ol>
<li>遵循boot规范      <ul>
<li>spring.factories默认配置文件</li>
<li>jar依赖规范</li>
</ul>
</li>
</ol>
<h2 id="相关配置"><a href="#相关配置" class="headerlink" title="相关配置"></a>相关配置</h2><h3 id="启动解析"><a href="#启动解析" class="headerlink" title="启动解析"></a>启动解析</h3><ul>
<li>SpringFactoriesLoader抽象类装载spring.factories</li>
</ul>
<p>每个spring-boot报META-INF下都会依赖spring.factory<br>    autoconfig检测：<a href="http://127.0.0.1:8888/autoconfig" target="_blank" rel="external">http://127.0.0.1:8888/autoconfig</a></p>
<pre><code>#Failure analyzers ()
org.springframework.boot.diagnostics.FailureAnalyzer
</code></pre><figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> List&lt;String&gt; <span class="title">loadFactoryNames</span><span class="params">(Class&lt;?&gt; factoryClass, ClassLoader classLoader)</span> </span>&#123;</div><div class="line">        String factoryClassName = factoryClass.getName();</div><div class="line"></div><div class="line">        <span class="keyword">try</span> &#123;</div><div class="line">            Enumeration ex = classLoader != <span class="keyword">null</span>?classLoader.getResources(<span class="string">"META-INF/spring.factories"</span>):ClassLoader.getSystemResources(<span class="string">"META-INF/spring.factories"</span>);</div><div class="line">            ArrayList result = <span class="keyword">new</span> ArrayList();</div><div class="line"></div><div class="line">            <span class="keyword">while</span>(ex.hasMoreElements()) &#123;</div><div class="line">                URL url = (URL)ex.nextElement();</div><div class="line">                Properties properties = PropertiesLoaderUtils.loadProperties(<span class="keyword">new</span> UrlResource(url));</div><div class="line">                String factoryClassNames = properties.getProperty(factoryClassName);</div><div class="line">                result.addAll(Arrays.asList(StringUtils.commaDelimitedListToStringArray(factoryClassNames)));</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> result;</div><div class="line">        &#125; <span class="keyword">catch</span> (IOException var8) &#123;</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException(<span class="string">"Unable to load ["</span> + factoryClass.getName() + <span class="string">"] factories from location ["</span> + <span class="string">"META-INF/spring.factories"</span> + <span class="string">"]"</span>, var8);</div><div class="line">        &#125;</div><div class="line">    &#125;</div></pre></td></tr></table></figure>
<ul>
<li>初始化 applicationContext IOC容器</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">public</span> ConfigurableApplicationContext <span class="title">run</span><span class="params">(String... args)</span> </span>&#123;</div><div class="line">	...</div><div class="line">	<span class="keyword">try</span> &#123;</div><div class="line">            DefaultApplicationArguments ex = <span class="keyword">new</span> DefaultApplicationArguments(args);</div><div class="line">            ConfigurableEnvironment environment = <span class="keyword">this</span>.prepareEnvironment(listeners, ex);</div><div class="line">            Banner printedBanner = <span class="keyword">this</span>.printBanner(environment);</div><div class="line">            context = <span class="keyword">this</span>.createApplicationContext();<span class="comment">//初始化 context</span></div><div class="line">            <span class="keyword">new</span> FailureAnalyzers(context);</div><div class="line">            <span class="keyword">this</span>.prepareContext(context, environment, listeners, ex, printedBanner);</div><div class="line">            <span class="keyword">this</span>.refreshContext(context);</div><div class="line">            <span class="keyword">this</span>.afterRefresh(context, ex);</div><div class="line">            listeners.finished(context, (Throwable)<span class="keyword">null</span>);</div><div class="line">            stopWatch.stop();</div><div class="line">            <span class="keyword">if</span>(<span class="keyword">this</span>.logStartupInfo) &#123;</div><div class="line">                (<span class="keyword">new</span> StartupInfoLogger(<span class="keyword">this</span>.mainApplicationClass)).logStarted(<span class="keyword">this</span>.getApplicationLog(), stopWatch);</div><div class="line">            &#125;</div><div class="line"></div><div class="line">            <span class="keyword">return</span> context;</div><div class="line">        &#125; <span class="keyword">catch</span> (Throwable var9) &#123;</div><div class="line">            <span class="keyword">this</span>.handleRunFailure(context, listeners, (FailureAnalyzers)analyzers, var9);</div><div class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> IllegalStateException(var9);</div><div class="line">        &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="外部化配置"><a href="#外部化配置" class="headerlink" title="外部化配置"></a>外部化配置</h3><p><a href="http://ip:port/env" target="_blank" rel="external">http://ip:port/env</a> （加载优先级 从上到下）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">Spring Boot设计了一个非常特别的PropertySource顺序，以允许对属性值进行合理的覆盖，属性会以如下的顺序进行设值：</div><div class="line">home目录下的devtools全局设置属性（~/.spring-boot-devtools.properties，如果devtools激活）。</div><div class="line">测试用例上的@TestPropertySource注解。</div><div class="line">测试用例上的@SpringBootTest#properties注解。</div><div class="line">命令行参数</div><div class="line">来自SPRING_APPLICATION_JSON的属性（环境变量或系统属性中内嵌的内联JSON）。</div><div class="line">ServletConfig初始化参数。</div><div class="line">ServletContext初始化参数。</div><div class="line">来自于java:comp/env的JNDI属性。</div><div class="line">Java系统属性（System.getProperties()）。</div><div class="line">操作系统环境变量。</div><div class="line">RandomValuePropertySource，只包含random.*中的属性。</div><div class="line">没有打进jar包的Profile-specific应用属性（application-&#123;profile&#125;.properties和YAML变量）。</div><div class="line">打进jar包中的Profile-specific应用属性（application-&#123;profile&#125;.properties和YAML变量）。</div><div class="line">没有打进jar包的应用配置（application.properties和YAML变量）。</div><div class="line">打进jar包中的应用配置（application.properties和YAML变量）。</div><div class="line">@Configuration类上的@PropertySource注解。</div><div class="line">默认属性（使用SpringApplication.setDefaultProperties指定）。</div></pre></td></tr></table></figure>
<h3 id="注解配置"><a href="#注解配置" class="headerlink" title="注解配置"></a>注解配置</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@ComponentScan：注解自动收集所有Spring组件，包括@Configuration类 </div><div class="line">@Configuration： 作为主要配置源</div><div class="line">@ImportResource：注解加载XML配置文件</div><div class="line">@EnableAutoConfiguration: 从classpath中搜寻所有的META-INF/spring.factories配置文件</div><div class="line">	借助@Import(&#123;EnableAutoConfigurationImportSelector.class&#125;)的帮助，</div><div class="line">	将所有符合自动配置条件的bean定义加载到IoC</div><div class="line">@SpringBootApplication注解等价于	</div><div class="line">    @Configuration+@EnableAutoConfiguration+@ComponentScan</div></pre></td></tr></table></figure>
<h3 id="实现自定义自动配置"><a href="#实现自定义自动配置" class="headerlink" title="实现自定义自动配置"></a>实现自定义自动配置</h3><ul>
<li>jvm参数监控</li>
<li>tomcat线程池监控</li>
</ul>
<h2 id="spring-boot模块"><a href="#spring-boot模块" class="headerlink" title="spring boot模块"></a>spring boot模块</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">spring-boot-starter-web	用于使用Spring MVC构建web应用，包括RESTful。Tomcat是默认的内嵌容器</div><div class="line">spring-boot-starter-jdbc	对JDBC的支持（使用Tomcat JDBC连接池）</div><div class="line">spring-boot-starter-aop	用于使用Spring AOP和AspectJ实现面向切面编程</div><div class="line">spring-boot-starter-test	用于测试Spring Boot应用，支持常用测试类库，包括JUnit, Hamcrest和Mockito</div><div class="line">spring-boot-starter-actuator	用于使用Spring Boot的Actuator，它提供了production ready功能来帮助你监控和管理应用程序</div><div class="line"></div><div class="line">所有模块:https://qbgbook.gitbooks.io/spring-boot-reference-guide-zh/content/III.%20Using%20Spring%20Boot/13.5.%20Starters.html</div></pre></td></tr></table></figure>
<h2 id="如何接入"><a href="#如何接入" class="headerlink" title="如何接入?"></a>如何接入?</h2><blockquote>
<p>1.pom parent依赖</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">只需在该依赖上指定Spring Boot版本，如果导入其他的starters，放心的省略版本号好了</div><div class="line"><span class="comment">&lt;!-- Inherit defaults from Spring Boot --&gt;</span></div><div class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></div><div class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.1.BUILD-SNAPSHOT<span class="tag">&lt;/<span class="name">version</span>&gt;</span></div><div class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></div></pre></td></tr></table></figure>
<blockquote>
<p>3.运行</p>
</blockquote>
<p>直接运行：mvn spring-boot:run<br>打包运行: mvn package  |  java -jar *.jar</p>
<blockquote>
<p>4.打包规范</p>
</blockquote>
<p><code>包命名规范</code>: </p>
<pre><code>${package-name}-online.jar  
${package-name}-online.war
${package-name}-online.conf
</code></pre><p>相关配置*.conf配置文件</p>
<pre><code>jvm配置/日志目录/java_Home
</code></pre><p><img src="http://i2.itc.cn/20171019/aac_44ff2159_b675_2098_94c8_e070df0b204b_1.png" alt=""></p>
<h2 id="升级接入遇到问题"><a href="#升级接入遇到问题" class="headerlink" title="升级接入遇到问题?"></a>升级接入遇到问题?</h2><ul>
<li><p>1.web.xml配置空,servlet、filter、inteceptor改用注解方式，自动扫描需用到注解</p>
<p>  @ServletComponentScan</p>
</li>
<li><p>2.依赖jsp的项目 pom依赖?</p>
</li>
<li><p>3.启动类Application需要在根目录，这样就可以自动扫描子目录的package</p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">将应用的main类放到其他类所在包的顶层(root package),并将@EnableAutoConfiguration注解到你的main类上，这样就隐式地定义了一个基础的包搜索路径（search package）以搜索某些特定的注解实体（比如@Service，@Component等）</div></pre></td></tr></table></figure>
</li>
<li><p>4.打包方式 依赖spring-boot-maven-plugin 需要指定启动类，打完jar war包是一个二进制文件 </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div><div class="line">75</div><div class="line">76</div><div class="line">77</div><div class="line">78</div><div class="line">79</div><div class="line">80</div><div class="line">81</div><div class="line">82</div><div class="line">83</div><div class="line">84</div><div class="line">85</div><div class="line">86</div><div class="line">87</div><div class="line">88</div><div class="line">89</div><div class="line">90</div><div class="line">91</div><div class="line">92</div></pre></td><td class="code"><pre><div class="line">	more *.jar | *.war 查看当前执行文件</div><div class="line">	</div><div class="line">	#!/bin/bash</div><div class="line">	#</div><div class="line">	#    .   ____          _            __ _ _</div><div class="line">	#   /\\ / ___&apos;_ __ _ _(_)_ __  __ _ \ \ \ \</div><div class="line">	#  ( ( )\___ | &apos;_ | &apos;_| | &apos;_ \/ _` | \ \ \ \</div><div class="line">	#   \\/  ___)| |_)| | | | | || (_| |  ) ) ) )</div><div class="line">	#    &apos;  |____| .__|_| |_|_| |_\__, | / / / /</div><div class="line">	#   =========|_|==============|___/=/_/_/_/</div><div class="line">	#   :: Spring Boot Startup Script ::</div><div class="line">	#</div><div class="line">		</div><div class="line">	### BEGIN INIT INFO</div><div class="line">	# Provides:          cachecloud-web</div><div class="line">	# Required-Start:    $remote_fs $syslog $network</div><div class="line">	# Required-Stop:     $remote_fs $syslog $network</div><div class="line">	# Default-Start:     2 3 4 5</div><div class="line">	# Default-Stop:      0 1 6</div><div class="line">	# Short-Description: cachecloud-web</div><div class="line">	# Description:       cachecloud-web</div><div class="line">	# chkconfig:         2345 99 01</div><div class="line">	### END INIT INFO</div><div class="line">	</div><div class="line">	[[ -n &quot;$DEBUG&quot; ]] &amp;&amp; set -x</div><div class="line">	</div><div class="line">	# Initialize variables that cannot be provided by a .conf file</div><div class="line">	WORKING_DIR=&quot;$(pwd)&quot;</div><div class="line">	# shellcheck disable=SC2153</div><div class="line">	[[ -n &quot;$JARFILE&quot; ]] &amp;&amp; jarfile=&quot;$JARFILE&quot;</div><div class="line">	[[ -n &quot;$APP_NAME&quot; ]] &amp;&amp; identity=&quot;$APP_NAME&quot;</div><div class="line">	</div><div class="line">	# Follow symlinks to find the real jar and detect init.d script</div><div class="line">	cd &quot;$(dirname &quot;$0&quot;)&quot; || exit 1</div><div class="line">	[[ -z &quot;$jarfile&quot; ]] &amp;&amp; jarfile=$(pwd)/$(basename &quot;$0&quot;)</div><div class="line">	while [[ -L &quot;$jarfile&quot; ]]; do</div><div class="line">	  [[ &quot;$jarfile&quot; =~ init\.d ]] &amp;&amp; init_script=$(basename &quot;$jarfile&quot;)</div><div class="line">	  jarfile=$(readlink &quot;$jarfile&quot;)</div><div class="line">	  cd &quot;$(dirname &quot;$jarfile&quot;)&quot; || exit 1</div><div class="line">	  jarfile=$(pwd)/$(basename &quot;$jarfile&quot;)</div><div class="line">	done</div><div class="line">	jarfolder=&quot;$(dirname &quot;$jarfile&quot;)&quot;</div><div class="line">	cd &quot;$WORKING_DIR&quot; || exit 1</div><div class="line">	# Source any config file</div><div class="line">	configfile=&quot;$(basename &quot;$&#123;jarfile%.*&#125;.conf&quot;)&quot;</div><div class="line">	# shellcheck source=/dev/null</div><div class="line">	[[ -r &quot;$&#123;jarfolder&#125;/$&#123;configfile&#125;&quot; ]] &amp;&amp; source &quot;$&#123;jarfolder&#125;/$&#123;configfile&#125;&quot;</div><div class="line">	</div><div class="line">	# Initialize PID/LOG locations if they weren&apos;t provided by the config file</div><div class="line">	[[ -z &quot;$PID_FOLDER&quot; ]] &amp;&amp; PID_FOLDER=&quot;/var/run&quot;</div><div class="line">	[[ -z &quot;$LOG_FOLDER&quot; ]] &amp;&amp; LOG_FOLDER=&quot;/var/log&quot;</div><div class="line">	! [[ -x &quot;$PID_FOLDER&quot; ]] &amp;&amp; PID_FOLDER=&quot;/tmp&quot;</div><div class="line">	! [[ -x &quot;$LOG_FOLDER&quot; ]] &amp;&amp; LOG_FOLDER=&quot;/tmp&quot;</div><div class="line">	</div><div class="line">	# Setup defaults</div><div class="line">	[[ -z &quot;$MODE&quot; ]] &amp;&amp; MODE=&quot;auto&quot; # modes are &quot;auto&quot;, &quot;service&quot; or &quot;run&quot;</div><div class="line">	</div><div class="line">	# Create an identity for log/pid files</div><div class="line">	if [[ -z &quot;$identity&quot; ]]; then</div><div class="line">	  if [[ -n &quot;$init_script&quot; ]]; then</div><div class="line">	    identity=&quot;$&#123;init_script&#125;&quot;</div><div class="line">	  else</div><div class="line">	    identity=$(basename &quot;$&#123;jarfile%.*&#125;&quot;)_$&#123;jarfolder//\//&#125;</div><div class="line">	  fi</div><div class="line">	fi</div><div class="line">	</div><div class="line">	# Initialize log file name if not provided by the config file</div><div class="line">	[[ -z &quot;$LOG_FILENAME&quot; ]] &amp;&amp; LOG_FILENAME=&quot;$&#123;identity&#125;.log&quot;</div><div class="line">	</div><div class="line">	</div><div class="line">	pom依赖：</div><div class="line">	 </div><div class="line">	&lt;plugin&gt;</div><div class="line">	        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</div><div class="line">	        &lt;artifactId&gt;spring-boot-maven-plugin&lt;/artifactId&gt;</div><div class="line">	        &lt;configuration&gt;</div><div class="line">	            &lt;mainClass&gt;启动类&lt;/mainClass&gt;</div><div class="line">	            &lt;addResources&gt;false&lt;/addResources&gt;</div><div class="line">	            &lt;executable&gt;true&lt;/executable&gt;</div><div class="line">	        &lt;/configuration&gt;</div><div class="line">	        &lt;executions&gt;</div><div class="line">	            &lt;execution&gt;</div><div class="line">	                &lt;goals&gt;</div><div class="line">	                    &lt;goal&gt;repackage&lt;/goal&gt;</div><div class="line">	                &lt;/goals&gt;</div><div class="line">	                &lt;id&gt;1&lt;/id&gt;</div><div class="line">	            &lt;/execution&gt;</div><div class="line">	        &lt;/executions&gt;</div><div class="line">	    &lt;/plugin&gt;</div><div class="line">	``` 	</div><div class="line"></div><div class="line">- 5.maven -Ponline 不生效问题 mvn clean compile -Plocal 配置打不进去</div></pre></td></tr></table></figure>
<p>  <plugin></plugin></p>
<pre><code>&lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt;
&lt;artifactId&gt;maven-resources-plugin&lt;/artifactId&gt;
&lt;configuration&gt;
    &lt;!-- spring-boot工程修改了默认的占位符${...}为@...@,修改会默认配置--&gt;
    &lt;useDefaultDelimiters&gt;true&lt;/useDefaultDelimiters&gt;
&lt;/configuration&gt;
</code></pre><p>  </p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">- 6.创建banner</div></pre></td></tr></table></figure>
<p>  1.在src/main/resource 下创建一个banner.txt文件<br>  2.生成的字符 放入banner.txt中<br>  public interface Banner {</p>
<pre><code>void printBanner(Environment var1, Class&lt;?&gt; var2, PrintStream var3);

public static enum Mode {
    OFF,
    CONSOLE,
    LOG;

    private Mode() {
    }
}
</code></pre><p>  }<br>  生成logo网站：<a href="http://patorjk.com/software/taag/#p=display&amp;f=Graffiti&amp;t=Type%20Something%20" target="_blank" rel="external">http://patorjk.com/software/taag/#p=display&amp;f=Graffiti&amp;t=Type%20Something%20</a></p>
  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">	</div><div class="line">- 7.当前项目所有类只有一个main函数</div></pre></td></tr></table></figure>
<p>  不然报以下错误:<br>  spring-boot-maven-plugin:1.4.6.RELEASE:repackage failed: Unable to find a single main class from the following candidates<br>  ```</p>
</li>
</ul>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/29/9.4) redis-客户端超时问题/" itemprop="url">
                  redis客户端超时分析
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-08-29T09:37:35+08:00" content="2017-08-29">
              2017-08-29
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/redis/" itemprop="url" rel="index">
                    <span itemprop="name">redis</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="常见的redis超时分析"><a href="#常见的redis超时分析" class="headerlink" title="常见的redis超时分析"></a>常见的redis超时分析</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">(1). 网络原因：比如是否存在跨机房、网络割接等等。</div><div class="line">(2). 慢查询，因为redis是单线程，如果有慢查询的话，会阻塞住之后的操作。 </div><div class="line">(3). value值过大？比如value几十兆，当然这种情况比较少，其实也可以看做是慢查询的一种</div><div class="line">(4). aof重写/rdb fork发生？瞬间会堵一下Redis服务器。</div><div class="line">(5). redis自身阻塞（swap fsync 磁盘io hugePage内存页未关闭）</div><div class="line">(5). 其他..................</div></pre></td></tr></table></figure>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/08/29/9.4) redis-客户端超时问题/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  
  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/08/23/9.2).redis工具使用/" itemprop="url">
                  redis常用工具
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            <span class="post-meta-item-icon">
              <i class="fa fa-calendar-o"></i>
            </span>
            <span class="post-meta-item-text">发表于</span>
            <time itemprop="dateCreated" datetime="2017-08-23T16:37:35+08:00" content="2017-08-23">
              2017-08-23
            </time>
          </span>

          
            <span class="post-category" >
              &nbsp; | &nbsp;
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/redis/" itemprop="url" rel="index">
                    <span itemprop="name">redis</span>
                  </a>
                </span>

                
                
                  ， 
                

              
                <span itemprop="about" itemscope itemtype="https://schema.org/Thing">
                  <a href="/categories/redis/python/" itemprop="url" rel="index">
                    <span itemprop="name">python</span>
                  </a>
                </span>

                
                

              
            </span>
          

          
            
          

          

          
          

          
        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          <h1 id="redis常用工具"><a href="#redis常用工具" class="headerlink" title="redis常用工具"></a>redis常用工具</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">环境准备:（注:不同redis版本可能会有差异）</div><div class="line"></div><div class="line">1.redis-server -v</div><div class="line">Redis server v=3.0.7 sha=00000000:0 malloc=jemalloc-3.6.0 bits=64 build=fde71d6d37f8bceb</div><div class="line"></div><div class="line">2.python -V </div><div class="line">Python 2.7.3</div><div class="line">下载：wget https://www.python.org/ftp/python/2.7.3/Python-2.7.3.tar.bz2</div><div class="line"></div><div class="line"></div><div class="line"></div><div class="line">3.python redis安装 rediscluster安装</div><div class="line"></div><div class="line">wget https://github.com/andymccurdy/redis-py/archive/2.10.5.zip</div><div class="line">unzip 2.10.5.zip</div><div class="line">cd redis-2.10.5</div><div class="line">python setup.py install</div><div class="line"></div><div class="line">wget https://github.com/Grokzen/redis-py-cluster/releases/download/1.3.4/redis-py-cluster-1.3.4.tar.gz</div><div class="line">tar -xvf redis-py-cluster-1.3.4.tar.gz</div><div class="line">cd redis-py-cluster-1.3.4</div><div class="line">python setup.py install</div><div class="line"></div><div class="line">4. 导入包</div><div class="line"></div><div class="line">import redis</div><div class="line">import rediscluster</div><div class="line">import sys</div></pre></td></tr></table></figure>
          <div class="post-more-link text-center">
            <a class="btn" href="/2017/08/23/9.2).redis工具使用/#more" rel="contents">
              阅读全文 &raquo;
            </a>
          </div>
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>

    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/5/">5</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel  sidebar-panel-active ">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/metor.ico"
               alt="Pedestrian" />
          <p class="site-author-name" itemprop="name">Pedestrian</p>
          <p class="site-description motion-element" itemprop="description">study for goal</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">46</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              <a href="/categories">
                <span class="site-state-item-count">33</span>
                <span class="site-state-item-name">分类</span>
              </a>
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">51</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/yanan0628" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://carlosfu.github.io/" target="_blank" title="fudada">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  fudada
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://jolinzhangg.github.io/" target="_blank" title="xiaodada">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  xiaodada
                </a>
              </span>
            
          
        </div>

        
        

        
        

      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy;  2016 - 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Pedestrian</span>
</div>

<div class="powered-by">
  由 <a class="theme-link" href="http://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Mist
  </a>
</div>

        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/vendors/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/vendors/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/vendors/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/vendors/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.0.1"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.0.1"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.0.1"></script>



  



  



  
  
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length == 0) {
       search_path = "search.xml";
    }
    var path = "/" + search_path;
    // monitor main search box;

    function proceedsearch() {
      $("body").append('<div class="popoverlay">').css('overflow', 'hidden');
      $('.popup').toggle();

    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
    'use strict';
    $.ajax({
        url: path,
        dataType: "xml",
        async: true,
        success: function( xmlResponse ) {
            // get the contents from search data
            isfetched = true;
            $('.popup').detach().appendTo('.header-inner');
            var datas = $( "entry", xmlResponse ).map(function() {
                return {
                    title: $( "title", this ).text(),
                    content: $("content",this).text(),
                    url: $( "url" , this).text()
                };
            }).get();
            var $input = document.getElementById(search_id);
            var $resultContent = document.getElementById(content_id);
            $input.addEventListener('input', function(){
                var matchcounts = 0;
                var str='<ul class=\"search-result-list\">';                
                var keywords = this.value.trim().toLowerCase().split(/[\s\-]+/);
                $resultContent.innerHTML = "";
                if (this.value.trim().length > 1) {
                // perform local searching
                datas.forEach(function(data) {
                    var isMatch = true;
                    var content_index = [];
                    var data_title = data.title.trim().toLowerCase();
                    var data_content = data.content.trim().replace(/<[^>]+>/g,"").toLowerCase();
                    var data_url = data.url;
                    var index_title = -1;
                    var index_content = -1;
                    var first_occur = -1;
                    // only match artiles with not empty titles and contents
                    if(data_title != '' && data_content != '') {
                        keywords.forEach(function(keyword, i) {
                            index_title = data_title.indexOf(keyword);
                            index_content = data_content.indexOf(keyword);
                            if( index_title < 0 && index_content < 0 ){
                                isMatch = false;
                            } else {
                                if (index_content < 0) {
                                    index_content = 0;
                                }
                                if (i == 0) {
                                    first_occur = index_content;
                                }
                            }
                        });
                    }
                    // show search results
                    if (isMatch) {
                        matchcounts += 1;
                        str += "<li><a href='"+ data_url +"' class='search-result-title'>"+ data_title +"</a>";
                        var content = data.content.trim().replace(/<[^>]+>/g,"");
                        if (first_occur >= 0) {
                            // cut out 100 characters
                            var start = first_occur - 20;
                            var end = first_occur + 80;
                            if(start < 0){
                                start = 0;
                            }
                            if(start == 0){
                                end = 50;
                            }
                            if(end > content.length){
                                end = content.length;
                            }
                            var match_content = content.substring(start, end);
                            // highlight all keywords
                            keywords.forEach(function(keyword){
                                var regS = new RegExp(keyword, "gi");
                                match_content = match_content.replace(regS, "<b class=\"search-keyword\">"+keyword+"</b>");
                            });
                            
                            str += "<p class=\"search-result\">" + match_content +"...</p>"
                        }
                        str += "</li>";
                    }
                })};
                str += "</ul>";
                if (matchcounts == 0) { str = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>' }
                if (keywords == "") { str = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>' }
                $resultContent.innerHTML = str;
            });
            proceedsearch();
        }
    });}

    // handle and trigger popup window;
    $('.popup-trigger').mousedown(function(e) {
      e.stopPropagation();
      if (isfetched == false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };

    });

    $('.popup-btn-close').click(function(e){
      $('.popup').hide();
      $(".popoverlay").remove();
      $('body').css('overflow', '');
    });
    $('.popup').click(function(e){
      e.stopPropagation();
    });
  </script>

  

  

  

</body>
</html>
